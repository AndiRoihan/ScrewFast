---
// Destructure the properties from Astro.props
const { url, name } = Astro.props;

// Define TypeScript interface for the properties
interface Props {
  url: string;
  name: string;
}

// Check if this is an anchor link (starts with #)
const isAnchor = url.startsWith('#');
const linkId = isAnchor ? url.substring(1) : (url === "/" ? "home" : url.replace("/", ""));
---

<a
  id={`nav-${linkId}`}
  href={url}
  data-astro-prefetch
  data-section={isAnchor ? url.substring(1) : ''}
  class="nav-link rounded-lg text-base font-medium text-neutral-600 outline-hidden ring-zinc-500 hover:text-neutral-500 focus-visible:ring-3 dark:text-neutral-400 dark:ring-zinc-200 dark:hover:text-neutral-500 dark:focus:outline-hidden md:py-3 md:text-sm 2xl:text-base transition-colors duration-200"
>
  {name}
</a>

<script>
  // Fungsi untuk set active link berdasarkan pathname
  function setActiveByPathname() {
    let url = window.location.pathname;
    let navId;

    if (url === "/") {
      navId = "nav-home";
    } else {
      navId = "nav-" + url.replace("/", "");
    }

    document.querySelectorAll('.nav-link').forEach(link => {
      link.classList.remove("text-orange-400", "dark:text-orange-300");
      link.classList.add("text-neutral-600", "dark:text-neutral-400");
      link.removeAttribute("aria-current");
    });

    let nav = document.getElementById(navId);
    if (nav) {
      nav.classList.remove("text-neutral-600", "dark:text-neutral-400");
      nav.classList.add("text-orange-400", "dark:text-orange-300");
      nav.setAttribute("aria-current", "page");
    }
  }

  function setupIntersectionObserver() {
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.nav-link[data-section]');

    if (sections.length === 0) return;

    const observerOptions = {
      root: null,
      rootMargin: '-20% 0px -70% 0px',
      threshold: 0
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const sectionId = entry.target.getAttribute('id');
          
          navLinks.forEach(link => {
            link.classList.remove("text-orange-400", "dark:text-orange-300");
            link.classList.add("text-neutral-600", "dark:text-neutral-400");
            link.removeAttribute("aria-current");
          });

          const activeLink = document.querySelector(`.nav-link[data-section="${sectionId}"]`);
          if (activeLink) {
            activeLink.classList.remove("text-neutral-600", "dark:text-neutral-400");
            activeLink.classList.add("text-orange-400", "dark:text-orange-300");
            activeLink.setAttribute("aria-current", "page");
          }
        }
      });
    }, observerOptions);

    sections.forEach(section => observer.observe(section));
  }

  document.addEventListener("DOMContentLoaded", function () {
    setActiveByPathname();
    setupIntersectionObserver();
  });

  document.addEventListener('astro:page-load', () => {
    setActiveByPathname();
    setupIntersectionObserver();
  });
</script>